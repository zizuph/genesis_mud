Combat aid for swarm
====================

For information on swarm background and how it fits into Calia's 
history, see ~Calia/guilds/calians/texts/battle. 

Swarm is an attacking skill that allows a player, when teamed 
against an opponent who is fighting a fellow team member, to 
attempt to sneak around its defences and deal it a blow. The 
idea is to take advantage on the fact the opponent will be 
concentrating on the other team member by hitting its exposed 
undefended flank with a swift, deft strike. Swarm can only be 
used in these circumstances.

Swarm also possesses a defensive part when used with other Calians.
Whenever a Calian is in a team, the tanker receives 20% evade.
Additionally, for each additional Calian teammate one has, the
tanker will receive an extra 10% evade. Note that the way evade
stacks is according to the Genesis evade shadow.

Combat Aid
----------
Using the Genesis Specials system, we simply set the combat aid
and all other calculations are set. Calian swarm has been set
at a maximum combat aid of 120%. This number changes, however,
depending on the situation.

Calian with no other Calians: 105%
Calian with other Calians:    120%

Combat aid can be reduced depending on unfavorable conditions
  - Weapon skill is taken as a percentage of the combat aid. Therefore
    if someone has less than sup guru, they would have less aid. For
    example, if someone had sup master skill in the weapon used for
    swarm, they would only receive 90% of the value above.
  - If there is a rogue tanker (someone not on the team) taking the
    hits, then the swarm combat aid is reduced to 1/3.

The combat aid for swarm is 25% (20% evade) for the tanker, and 10%
for each additional teammate, to a maximum of 50% combat aid provided
to the tanker for the swarm evade.

Here is a description of all the situations and their combat aid
Solo Calian:
    swarm combat aid:                   0%

Tanking Team Calian:
    swarm evade:                        25% (evade)
    swarm evade (additional):           10% per Calian up to 50%

Swarming Team Calian (only non-Calian Tanker):
    swarm combat aid:                   105% (attack only)
    
Swarming Team Calian (with Calian Tanker):
    swarm combat aid:                   120% (attack only)
    
Frequency
---------
Frequency of swarm is once every 10 seconds, and given that there is one 
combat round every 5 seconds, swarm frequency is 1/2. The actual time
is randomized when using the Genesis specials library.

Hit chance
----------
When deciding whether a hit attempt succeeds, swarm uses cb_tohit 
with a tohit value as follows: 

    tohit = min(max((player->query_skill(SS_SWARM_KNOWLEDGE) / 2), 
                     player->query_stat(SS_WIS) / 2), 50) 
          + ((25 * weapon->query_hit()) / 13);

This means that for a 40/40 weapon, a swarm skill of 100 and wisdom 
of 100, the tohit value of swarm is 126, which gives a typical hit 
chance of 94%, and a combat aid reduction of 6%. 

Penetration
-----------
Penetration of swarm varies depending on the weapon's pen, player 
DEX and STR, and if one has another 
Calian in the team. 

Everything else is calculated by the Genesis Specials system.

Mana/fatigue drawback
---------------------
Each swarm takes 2 fatigue and 1 mana when not fighting in a team 
alongside a fellow Calian, but 1 fatigue and 0.5 mana on average 
otherwise. 

Usage drawback
--------------
Swarm is a very powerful attack in the right circumstances, i.e. 
given a decent weapon and the right position in a team. Swarmers 
are however ineffective alone when compared to the member of a 
solo occupational fighter guild. Also, in situations where the 
swarmer has to tank, for whatever reason, they may not use their 
ability.

Note: Attacking a Calian who is preparing to swarm will automatically
      stop the swarm.

Document by Petros
